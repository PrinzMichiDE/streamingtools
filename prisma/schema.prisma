generator client {
  provider = "prisma-client"
  output   = "../src/lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id           String         @id @default(cuid())
  twitchId     String         @unique
  username     String
  displayName  String
  email        String?        @unique
  avatar       String?
  accessToken  String
  refreshToken String
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  accounts     Account[]
  alertConfig  AlertConfig?
  commands     ChatCommand[]
  counters     Counter[]
  gameInfo     GameInfo?
  goals        Goal[]
  locations    Location[]
  musicInfo    MusicInfo?
  overlays     Overlay[]
  polls        Poll[]
  questions    Question[]
  sessions     Session[]
  sounds       Sound[]
  speedrun     SpeedrunTimer?
  topics       Topic[]
  settings     UserSettings?
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Overlay {
  id        String      @id @default(cuid())
  userId    String
  type      OverlayType
  name      String
  isActive  Boolean     @default(true)
  config    Json
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  user      User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, type])
  @@index([userId])
}

model Goal {
  id        String    @id @default(cuid())
  userId    String
  title     String
  type      GoalType
  target    Int
  current   Int       @default(0)
  isActive  Boolean   @default(true)
  endsAt    DateTime?
  style     Json
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Poll {
  id        String       @id @default(cuid())
  userId    String
  question  String
  isActive  Boolean      @default(true)
  endsAt    DateTime?
  createdAt DateTime     @default(now())
  user      User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  options   PollOption[]

  @@index([userId])
}

model PollOption {
  id     String  @id @default(cuid())
  pollId String
  text   String
  votes  Int     @default(0)
  color  String?
  poll   Poll    @relation(fields: [pollId], references: [id], onDelete: Cascade)

  @@index([pollId])
}

model AlertConfig {
  id             String   @id @default(cuid())
  userId         String   @unique
  followEnabled  Boolean  @default(true)
  followSound    String?
  followDuration Int      @default(5)
  subEnabled     Boolean  @default(true)
  subSound       String?
  subDuration    Int      @default(8)
  bitsEnabled    Boolean  @default(true)
  raidEnabled    Boolean  @default(true)
  styles         Json
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Location {
  id        String   @id @default(cuid())
  userId    String
  lat       Float
  lng       Float
  speed     Float?
  altitude  Float?
  accuracy  Float?
  heading   Float?
  timestamp DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, timestamp])
}

model UserSettings {
  id             String   @id @default(cuid())
  userId         String   @unique
  timezone       String   @default("Europe/Berlin")
  language       String   @default("de")
  theme          String   @default("neon-purple")
  notifyOnFollow Boolean  @default(true)
  notifyOnSub    Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model GameInfo {
  id        String   @id @default(cuid())
  userId    String   @unique
  gameName  String?
  gameId    String?
  category  String?
  title     String?
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Counter {
  id        String      @id @default(cuid())
  userId    String
  type      CounterType
  name      String
  value     Int         @default(0)
  style     Json
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  user      User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, type])
  @@index([userId])
}

model SpeedrunTimer {
  id        String    @id @default(cuid())
  userId    String    @unique
  isRunning Boolean   @default(false)
  startTime DateTime?
  splits    Json
  pbTime    Int?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Topic {
  id        String   @id @default(cuid())
  userId    String
  text      String
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Question {
  id        String   @id @default(cuid())
  userId    String
  text      String
  askedBy   String?
  answered  Boolean  @default(false)
  position  Int
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model MusicInfo {
  id        String   @id @default(cuid())
  userId    String   @unique
  title     String?
  artist    String?
  album     String?
  coverUrl  String?
  spotifyId String?
  bpm       Int?
  duration  Int?
  progress  Int?
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model ChatCommand {
  id        String   @id @default(cuid())
  userId    String
  command   String
  response  String
  cooldown  Int      @default(0)
  enabled   Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, command])
  @@index([userId])
}

model Sound {
  id        String   @id @default(cuid())
  userId    String
  name      String
  fileUrl   String
  volume    Float    @default(1.0)
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

enum OverlayType {
  CHAT
  ALERTS
  GOALS
  COUNTDOWN
  VIEWER_COUNTER
  STREAM_HEALTH
  HYPE_TRAIN
  SCHEDULE
  SOCIAL_LINKS
  NOW_PLAYING
  GAME_INFO
  DEATH_COUNTER
  KILL_COUNTER
  HEALTH_BAR
  SPEEDRUN_TIMER
  SCORE_TRACKER
  ACHIEVEMENT
  LOCATION
  SPEED
  ALTITUDE
  COMPASS
  WEATHER
  BATTERY
  TRIP_STATS
  TOPIC
  QUESTION_QUEUE
  DRAWING_CANVAS
  COLOR_PALETTE
  ART_PROGRESS
  SONG_QUEUE
  BPM
  WAVEFORM
}

enum GoalType {
  SUBS
  FOLLOWERS
  DONATIONS
  BITS
  CUSTOM
}

enum CounterType {
  DEATH
  KILL
  WIN
  LOSS
  STREAK
  CUSTOM
}
